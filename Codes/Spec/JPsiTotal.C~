#ifndef __CINT__
#endif
#include "TLatex.h"
#include "TCanvas.h"
#include "TROOT.h"
#include "TAxis.h"
#include "TH1.h"
#include "TTree.h"
#include "TFile.h"
#include "TH1D.h"
#include "TF1.h"
#include "TH1I.h"
#include "TCanvas.h"
#include "TLine.h"
#include "TMath.h"
#include "TVector3.h"
#include "TString.h"
#include "TLegend.h"
#include "TStyle.h"
#include "TGraphErrors.h"
#include <fstream>
#include <map>
#include <string>
#include <iostream>
#include <stdio.h>
#include <string.h>
#include "TObjArray.h"
#include "TGaxis.h"
#include "TLine.h"
#include "TColor.h"
#include "TStyle.h"
#include <iostream>
#include <iomanip>
#include "TGraphAsymmErrors.h"

void Draw_CMS_D2NDPtDy_PromptJPsi_Y0009_Pt(TLegend *lgd);
void Draw_CMS_D2NDPtDy_PromptJPsi_Y0912_Pt(TLegend *lgd);

void JPsiTotal()
{

gROOT->SetStyle("Plain");
  gStyle->SetPalette(1);
  gStyle->SetOptTitle(0);
  //gStyle->SetOptStat("nmr");
  gStyle->SetOptStat(0);
  gStyle->SetOptFit(0);
  
  gStyle->SetTitleFillColor(0);
  gStyle->SetStatColor(0);

  gStyle->SetFrameBorderMode(0);
  gStyle->SetFrameFillColor(0);
  gStyle->SetFrameLineColor(kBlack);

  gStyle->SetCanvasColor(0);
  gStyle->SetCanvasBorderMode(0);
  gStyle->SetCanvasBorderSize(0);

  gStyle->SetPadColor(0);
  gStyle->SetPadBorderMode(0);
  gStyle->SetPadBorderSize(0);

  gStyle->SetTextSize(0.04);
  gStyle->SetTextFont(42);
  gStyle->SetLabelFont(42,"xyz");
  gStyle->SetTitleFont(42,"xyz");
  gStyle->SetTitleSize(0.048,"xyz");
  gStyle->SetPadBottomMargin(0.12);
  gStyle->SetPadTopMargin(0.03);
  gStyle->SetPadRightMargin(0.065);
  gStyle->SetPadLeftMargin(0.12);

  //gStyle->SetTitleXOffset(1.15);
  //gStyle->SetTitleYOffset(1.2);

  gStyle->SetPadTickX(1);
  gStyle->SetPadTickY(1);

  gStyle->SetCanvasDefH(600);
  gStyle->SetCanvasDefW(600);
  gStyle->SetHistMinimumZero(kTRUE);
  gStyle->SetErrorX(0);   
  gStyle->SetEndErrorSize(0);

  gStyle->SetMarkerStyle(20);
  gStyle->SetMarkerSize(1.3);

  gROOT->ForceStyle();
  

  TLegend *legd0 = new TLegend(0.16,0.64,0.97,0.93);
  legd0->SetBorderSize(0);
  legd0->SetFillStyle(0);
  legd0->SetFillColor(0);
  legd0->SetTextSize(0.040);
  

  TLatex *tb= new TLatex;
  tb->SetNDC(); 
  tb->SetTextAlign(12);
  tb->SetTextColor(1);
  tb->SetTextSize(0.040);


  //=========================== BR =================//
  Double_t BR_JPsiToMuMu = 0.0593;
  Double_t BR_Psi2SToMuMu = 0.0078;

  Double_t BR_Psi2SToJPsi = 0.595;
  Double_t BR_ChiC0ToJPsi = 0.0116;
  Double_t BR_ChiC1ToJPsi = 0.344;
  Double_t BR_ChiC2ToJPsi = 0.195;

  
  TFile *file_JPsiCrossSection =  new TFile("JPsiCrossSection.root","R");

  TGraph *JPsi_grDSigmaDPtDY_Pt =(TGraph*)file_JPsiCrossSection->Get("grDSigmaDPtDY_Pt");
  JPsi_grDSigmaDPtDY_Pt->SetName("JPsi_grDSigmaDPtDY_Pt");
  JPsi_grDSigmaDPtDY_Pt->SetTitle("JPsi_grDSigmaDPtDY_Pt");
  JPsi_grDSigmaDPtDY_Pt->SetLineWidth(2);
  JPsi_grDSigmaDPtDY_Pt->SetLineColor(4);
  JPsi_grDSigmaDPtDY_Pt->GetXaxis()->SetTitle("p_{T}(GeV/c)");
  JPsi_grDSigmaDPtDY_Pt->GetYaxis()->SetTitle("d^{2}#sigma/dp_{T}dy(nb/GeV)");
  
  
  //mean1 =  (TGraphErrors*)grmean->Clone();
  TGraph *TotalJPsi_grDSigmaDPtDY_Pt=(TGraph*)JPsi_grDSigmaDPtDY_Pt->Clone();
  TotalJPsi_grDSigmaDPtDY_Pt->SetName("JPsi_grDSigmaDPtDY_Pt");
  TotalJPsi_grDSigmaDPtDY_Pt->SetTitle("JPsi_grDSigmaDPtDY_Pt");
  TotalJPsi_grDSigmaDPtDY_Pt->SetLineWidth(2);
  TotalJPsi_grDSigmaDPtDY_Pt->SetLineColor(2);
  TotalJPsi_grDSigmaDPtDY_Pt->GetXaxis()->SetTitle("p_{T}(GeV/c)");
  TotalJPsi_grDSigmaDPtDY_Pt->GetYaxis()->SetTitle("d^{2}#sigma/dp_{T}dy(nb/GeV)");



  TFile *file_Psi2SCrossSection =  new TFile("Psi2SCrossSection.root","R");

  TGraph *Psi2S_grDSigmaDPtDY_Pt =(TGraph*)file_Psi2SCrossSection->Get("grDSigmaDPtDY_Pt");
  Psi2S_grDSigmaDPtDY_Pt->SetName("Psi2S_grDSigmaDPtDY_Pt");
  Psi2S_grDSigmaDPtDY_Pt->SetTitle("Psi2S_grDSigmaDPtDY_Pt");
  Psi2S_grDSigmaDPtDY_Pt->SetLineWidth(2);
  Psi2S_grDSigmaDPtDY_Pt->SetLineColor(6);
  Psi2S_grDSigmaDPtDY_Pt->GetXaxis()->SetTitle("p_{T}(GeV/c)");
  Psi2S_grDSigmaDPtDY_Pt->GetYaxis()->SetTitle("d^{2}#sigma/dp_{T}dy(nb/GeV)");

 
 
  TFile *file_ChiC0CrossSection =  new TFile("Chic0_1PCrossSection.root","R");

  TGraph *ChiC0_grDSigmaDPtDY_Pt =(TGraph*)file_ChiC0CrossSection->Get("grDSigmaDPtDY_Pt");
  ChiC0_grDSigmaDPtDY_Pt->SetName("ChiC0_grDSigmaDPtDY_Pt");
  ChiC0_grDSigmaDPtDY_Pt->SetTitle("ChiC0_grDSigmaDPtDY_Pt");
  ChiC0_grDSigmaDPtDY_Pt->SetLineWidth(2);
  ChiC0_grDSigmaDPtDY_Pt->SetLineColor(7);
  ChiC0_grDSigmaDPtDY_Pt->GetXaxis()->SetTitle("p_{T}(GeV/c)");
  ChiC0_grDSigmaDPtDY_Pt->GetYaxis()->SetTitle("d^{2}#sigma/dp_{T}dy(nb/GeV)");

  

  TFile *file_ChiC1CrossSection =  new TFile("Chic1_1PCrossSection.root","R");

  TGraph *ChiC1_grDSigmaDPtDY_Pt =(TGraph*)file_ChiC1CrossSection->Get("grDSigmaDPtDY_Pt");
  ChiC1_grDSigmaDPtDY_Pt->SetName("ChiC1_grDSigmaDPtDY_Pt");
  ChiC1_grDSigmaDPtDY_Pt->SetTitle("ChiC1_grDSigmaDPtDY_Pt");
  ChiC1_grDSigmaDPtDY_Pt->SetLineWidth(2);
  ChiC1_grDSigmaDPtDY_Pt->SetLineColor(9);
  ChiC1_grDSigmaDPtDY_Pt->GetXaxis()->SetTitle("p_{T}(GeV/c)");
  ChiC1_grDSigmaDPtDY_Pt->GetYaxis()->SetTitle("d^{2}#sigma/dp_{T}dy(nb/GeV)");


  TFile *file_ChiC2CrossSection =  new TFile("Chic2_1PCrossSection.root","R");

  TGraph *ChiC2_grDSigmaDPtDY_Pt =(TGraph*)file_ChiC2CrossSection->Get("grDSigmaDPtDY_Pt");
  ChiC2_grDSigmaDPtDY_Pt->SetName("ChiC2_grDSigmaDPtDY_Pt");
  ChiC2_grDSigmaDPtDY_Pt->SetTitle("ChiC2_grDSigmaDPtDY_Pt");
  ChiC2_grDSigmaDPtDY_Pt->SetLineWidth(2);
  ChiC2_grDSigmaDPtDY_Pt->SetLineColor(12);
  ChiC2_grDSigmaDPtDY_Pt->GetXaxis()->SetTitle("p_{T}(GeV/c)");
  ChiC2_grDSigmaDPtDY_Pt->GetYaxis()->SetTitle("d^{2}#sigma/dp_{T}dy(nb/GeV)");






  
  for (int j=0; j < JPsi_grDSigmaDPtDY_Pt->GetN();++j){
    
    Double_t Pt, DirectJPsi,DirectPsi2S,DirectChiC0, DirectChiC1,DirectChiC2;
    Double_t TotalJPsi;
    
    JPsi_grDSigmaDPtDY_Pt->GetPoint(j,Pt,DirectJPsi);
    Psi2S_grDSigmaDPtDY_Pt->GetPoint(j,Pt,DirectPsi2S);

    ChiC0_grDSigmaDPtDY_Pt->GetPoint(j,Pt,DirectChiC0);
    ChiC1_grDSigmaDPtDY_Pt->GetPoint(j,Pt,DirectChiC1);
    ChiC2_grDSigmaDPtDY_Pt->GetPoint(j,Pt,DirectChiC2);

    Double_t DY = 1.8;
    TotalJPsi = (DirectJPsi*BR_JPsiToMuMu + DirectPsi2S*BR_Psi2SToJPsi*BR_JPsiToMuMu + DirectChiC0*BR_ChiC0ToJPsi*BR_JPsiToMuMu 
		 + DirectChiC1*BR_ChiC1ToJPsi*BR_JPsiToMuMu+DirectChiC2*BR_ChiC2ToJPsi*BR_JPsiToMuMu)/DY;
    
    TotalJPsi_grDSigmaDPtDY_Pt->SetPoint(j,Pt,TotalJPsi);
    
    JPsi_grDSigmaDPtDY_Pt->SetPoint(j,Pt,DirectJPsi*BR_JPsiToMuMu/DY);
    Psi2S_grDSigmaDPtDY_Pt->SetPoint(j,Pt,DirectPsi2S*BR_Psi2SToJPsi*BR_JPsiToMuMu/DY);
    
    ChiC0_grDSigmaDPtDY_Pt->SetPoint(j,Pt,DirectChiC0*BR_ChiC0ToJPsi*BR_JPsiToMuMu/DY);
    ChiC1_grDSigmaDPtDY_Pt->SetPoint(j,Pt,DirectChiC1*BR_ChiC1ToJPsi*BR_JPsiToMuMu/DY);
    ChiC2_grDSigmaDPtDY_Pt->SetPoint(j,Pt,DirectChiC2*BR_ChiC2ToJPsi*BR_JPsiToMuMu/DY);
  }

  TLegend *lgd_DSigmaDPtDY_Pt = new TLegend(0.40,0.60,0.90,0.92);
  lgd_DSigmaDPtDY_Pt->SetBorderSize(0);
  lgd_DSigmaDPtDY_Pt->SetFillStyle(0);
  lgd_DSigmaDPtDY_Pt->SetFillColor(0);
  lgd_DSigmaDPtDY_Pt->SetTextSize(0.03);
  
  new TCanvas; 
  gPad->SetTicks();
  gPad->SetLogy(1);
  gPad->SetLeftMargin(0.18);
  Draw_CMS_D2NDPtDy_PromptJPsi_Y0009_Pt(lgd_DSigmaDPtDY_Pt);

  lgd_DSigmaDPtDY_Pt->AddEntry(TotalJPsi_grDSigmaDPtDY_Pt,"NRQCD, Prompt J/#psi","L");
  lgd_DSigmaDPtDY_Pt->AddEntry(JPsi_grDSigmaDPtDY_Pt,"NRQCD, Direct J/#psi","L");
  lgd_DSigmaDPtDY_Pt->AddEntry(Psi2S_grDSigmaDPtDY_Pt,"NRQCD, J/#psi from #psi(2S)","L");
  lgd_DSigmaDPtDY_Pt->AddEntry(ChiC0_grDSigmaDPtDY_Pt,"NRQCD, J/#psi from #chi_{c0}","L");
  lgd_DSigmaDPtDY_Pt->AddEntry(ChiC1_grDSigmaDPtDY_Pt,"NRQCD, J/#psi from #chi_{c1}","L");
  lgd_DSigmaDPtDY_Pt->AddEntry(ChiC2_grDSigmaDPtDY_Pt,"NRQCD, J/#psi from #chi_{c2}","L");


  TotalJPsi_grDSigmaDPtDY_Pt->GetYaxis()->SetTitleOffset(1.6);
   
  TotalJPsi_grDSigmaDPtDY_Pt->Draw("Csame");
  JPsi_grDSigmaDPtDY_Pt->Draw("Csame");
  Psi2S_grDSigmaDPtDY_Pt->Draw("Csame");
  
  ChiC0_grDSigmaDPtDY_Pt->Draw("Csame");
  ChiC1_grDSigmaDPtDY_Pt->Draw("Csame");
  ChiC2_grDSigmaDPtDY_Pt->Draw("Csame");


  lgd_DSigmaDPtDY_Pt->Draw("same");
  
}


//==============================================================================================//
//=========================== DATA FUNCTIONS ===================================================//
//=============================================================================================//


void Draw_CMS_D2NDPtDy_PromptJPsi_Y0009_Pt(TLegend *lgd)
{
  
  Double_t p8319_d1x1y1_xval[10] = { 8.569, 9.515, 10.494, 11.485, 12.711, 14.206, 16.329, 21.77, 35.03, 52.7 };
  
  Double_t p8319_d1x1y1_xerrminus[10] = { 0.5690000000000008, 0.5150000000000006, 0.4939999999999998, 0.48499999999999943, 
				       0.7110000000000003, 0.7059999999999995, 1.3290000000000006, 3.7699999999999996, 
				      5.030000000000001, 7.700000000000003 };
  Double_t p8319_d1x1y1_xerrplus[10] = { 0.43099999999999916, 0.48499999999999943, 0.5060000000000002, 0.5150000000000006, 
				      0.7889999999999997, 0.7940000000000005, 1.6709999999999994, 8.23, 9.969999999999999,
				      17.299999999999997 };
  Double_t p8319_d1x1y1_yval[10] = { 2.54, 1.56, 0.96, 0.612, 0.351, 0.184, 0.0841, 0.0139, 7.8E-4, 7.0E-5 };

  Double_t p8319_d1x1y1_yerrminus[10] = { 0.13601470508735444, 0.11224972160321824, 0.06, 0.0366742416417845, 0.020024984394500785, 
				      0.009486832980505138, 0.004423799272118932, 8.062257748298549E-4, 5.1961524227066324E-5, 
				      1.862793601019716E-5 };
  Double_t p8319_d1x1y1_yerrplus[10] = { 0.13601470508735444, 0.11224972160321824, 0.06, 0.0366742416417845, 0.020024984394500785, 
				     0.009486832980505138, 0.004423799272118932, 8.062257748298549E-4, 5.1961524227066324E-5,
				     1.862793601019716E-5 };
  Double_t p8319_d1x1y1_ystatminus[10] = { 0.07, 0.03, 0.02, 0.012, 0.006, 0.004, 0.0015, 2.0E-4, 3.0E-5, 7.0E-6 };
  Double_t p8319_d1x1y1_ystatplus[10] = { 0.07, 0.03, 0.02, 0.012, 0.006, 0.004, 0.0015, 2.0E-4, 3.0E-5, 7.0E-6 };


  TGraphAsymmErrors *Grf_CMS_D2NDPtDy_PromptJPsi_Y0009_Pt = new TGraphAsymmErrors(10,p8319_d1x1y1_xval, p8319_d1x1y1_yval, p8319_d1x1y1_xerrminus, 
										  p8319_d1x1y1_xerrplus, p8319_d1x1y1_yerrminus, p8319_d1x1y1_yerrplus);
  Grf_CMS_D2NDPtDy_PromptJPsi_Y0009_Pt->SetMarkerStyle(20);
  Grf_CMS_D2NDPtDy_PromptJPsi_Y0009_Pt->SetMarkerColor(kBlack+0);
  Grf_CMS_D2NDPtDy_PromptJPsi_Y0009_Pt->SetMarkerSize(1.6);
  Grf_CMS_D2NDPtDy_PromptJPsi_Y0009_Pt->GetYaxis()->SetTitleOffset(1.6);
  Grf_CMS_D2NDPtDy_PromptJPsi_Y0009_Pt->GetYaxis()->SetRangeUser(0.000001,10000.0);
  
  TAxis *Xaxis1 = Grf_CMS_D2NDPtDy_PromptJPsi_Y0009_Pt->GetXaxis();
  Xaxis1->SetLimits(0.0,70.0);
   

  Grf_CMS_D2NDPtDy_PromptJPsi_Y0009_Pt->GetXaxis()->SetTitle("p_{T}[GeV/c]");
  Grf_CMS_D2NDPtDy_PromptJPsi_Y0009_Pt->GetYaxis()->SetTitle("#frac{d^{2}#sigma}{dp_{T}dy}[nb/GeV]");
  
  Grf_CMS_D2NDPtDy_PromptJPsi_Y0009_Pt->Draw("AP");

  
  TBox *SystErr[10];
 
  for(int j=0;j<10;j++){
    SystErr[j] = new TBox(p8319_d1x1y1_xval[j]-0.5, p8319_d1x1y1_yval[j]-p8319_d1x1y1_ystatminus[j], p8319_d1x1y1_xval[j]+0.5, p8319_d1x1y1_yval[j]+p8319_d1x1y1_ystatplus[j]);
  }
  for(int j=0;j<10;j++){
    SystErr[j]->SetFillStyle(9001);
    SystErr[j]->SetLineColor(kBlack);
    SystErr[j]->Draw("same"); 
  }
  


  TLatex *tb= new TLatex;
  tb->SetNDC(); 
  tb->SetTextAlign(12);
  tb->SetTextColor(1);
  tb->SetTextSize(0.040);
  tb->DrawLatex(0.21,0.25,"pp #sqrt{s_{_{NN}}} = 7.0 TeV");
  tb->DrawLatex(0.21,0.20,"|y| #leq 0.9");
 
  lgd->AddEntry(Grf_CMS_D2NDPtDy_PromptJPsi_Y0009_Pt,"CMS prompt J/#psi", "P");
  
  
  
}


void Draw_CMS_D2NDPtDy_PromptJPsi_Y0912_Pt(TLegend *lgd)
{
  
  double p8319_d2x1y1_xval[6] = { 8.524, 9.491, 10.921, 13.312, 18.95, 34.7 };
  double p8319_d2x1y1_xerrminus[6] = { 0.5239999999999991, 0.49099999999999966, 0.9209999999999994, 1.3119999999999994, 3.9499999999999993, 4.700000000000003 };
  double p8319_d2x1y1_xerrplus[6] = { 0.47600000000000087, 0.5090000000000003, 1.0790000000000006, 1.6880000000000006, 11.05, 10.299999999999997 };
  double p8319_d2x1y1_yval[6] = { 2.62, 1.55, 0.75, 0.248, 0.0264, 6.7E-4 };
  double p8319_d2x1y1_yerrminus[6] = { 0.1972308292331602, 0.14317821063276354, 0.053851648071345036, 0.01746424919657298, 0.0014352700094407323, 8.366600265340756E-5 };
  double p8319_d2x1y1_yerrplus[6] = { 0.1972308292331602, 0.14317821063276354, 0.053851648071345036, 0.01746424919657298, 0.0014352700094407323, 8.366600265340756E-5 };
  double p8319_d2x1y1_ystatminus[6] = { 0.08, 0.05, 0.02, 0.006, 6.0E-4, 6.0E-5 };
  double p8319_d2x1y1_ystatplus[6] = { 0.08, 0.05, 0.02, 0.006, 6.0E-4, 6.0E-5 };


  TGraphAsymmErrors *Grf_CMS_D2NDPtDy_PromptJPsi_Y0912_Pt = new TGraphAsymmErrors(6,p8319_d2x1y1_xval, p8319_d2x1y1_yval, p8319_d2x1y1_xerrminus, 
										  p8319_d2x1y1_xerrplus, p8319_d2x1y1_yerrminus, p8319_d2x1y1_yerrplus);
  Grf_CMS_D2NDPtDy_PromptJPsi_Y0912_Pt->SetMarkerStyle(20);
  Grf_CMS_D2NDPtDy_PromptJPsi_Y0912_Pt->SetMarkerColor(kBlack+0);
  Grf_CMS_D2NDPtDy_PromptJPsi_Y0912_Pt->SetMarkerSize(1.6);
  Grf_CMS_D2NDPtDy_PromptJPsi_Y0912_Pt->GetYaxis()->SetTitleOffset(1.6);
  Grf_CMS_D2NDPtDy_PromptJPsi_Y0912_Pt->GetYaxis()->SetRangeUser(0.000001,10000.0);
  
  TAxis *Xaxis1 = Grf_CMS_D2NDPtDy_PromptJPsi_Y0912_Pt->GetXaxis();
  Xaxis1->SetLimits(0.0,70.0);
   

  Grf_CMS_D2NDPtDy_PromptJPsi_Y0912_Pt->GetXaxis()->SetTitle("p_{T}[GeV/c]");
  Grf_CMS_D2NDPtDy_PromptJPsi_Y0912_Pt->GetYaxis()->SetTitle("#frac{d^{2}#sigma}{dp_{T}dy}[nb/GeV]");
  
  Grf_CMS_D2NDPtDy_PromptJPsi_Y0912_Pt->Draw("AP");

  
  TBox *SystErr[6];
 
  for(int j=0;j<6;j++){
    SystErr[j] = new TBox(p8319_d2x1y1_xval[j]-0.5, p8319_d2x1y1_yval[j]-p8319_d2x1y1_ystatminus[j], 
			  p8319_d2x1y1_xval[j]+0.5, p8319_d2x1y1_yval[j]+p8319_d2x1y1_ystatplus[j]);
  }
  for(int j=0;j<6;j++){
    SystErr[j]->SetFillStyle(9001);
    SystErr[j]->SetLineColor(kBlack);
    SystErr[j]->Draw("same"); 
  }
  

  TLatex *tb= new TLatex;
  tb->SetNDC(); 
  tb->SetTextAlign(12);
  tb->SetTextColor(1);
  tb->SetTextSize(0.040);
  tb->DrawLatex(0.21,0.25,"pp #sqrt{s_{_{NN}}} = 7.0 TeV");
  tb->DrawLatex(0.21,0.20,"0.9 #leq |y| #leq 1.2");
 
  lgd->AddEntry(Grf_CMS_D2NDPtDy_PromptJPsi_Y0912_Pt,"CMS prompt J/#psi", "P");
  
   
}

